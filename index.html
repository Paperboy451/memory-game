<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lieblingsgetr√§nke Memory</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@500;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Comic Neue', 'Comic Sans MS', cursive, sans-serif;
    background: #ffd27f; /* feste Farbe */
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 0;
  }
  header {
    text-align: center;
    padding: 10px;
    color: #333;
  }
  .scoreboard {
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }
  .player {
    padding: 4px 10px;
    border-radius: 8px;
    transition: all 0.3s;
  }
  .active {
    background: #ff6f61;
    color: #fff;
    transform: scale(1.1);
  }
  .game-board {
    display: grid;
    justify-content: center;
    gap: 15px;
    max-width: 95vw;
  }

  .card {
    perspective: 1000px;
    aspect-ratio: 1 / 1;
    position: relative;
  }
  .card-inner {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0; 
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    border-radius: 12px;
    box-sizing: border-box; 
  }
  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }
  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0; 
    box-sizing: border-box;
    backface-visibility: hidden;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.5rem;
    border: 3px solid #333;
  }
  .card-front {
    background: #fff3c4;
    color: #333;
    overflow: hidden;
  }
  .card-front img {
    display: block;
    width: 100%; 
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    border: none; 
  }
  .card-back {
    background: #ff6f61;
    transform: rotateY(180deg);
    overflow: hidden;
  }
  .card-back img {
    display: block;
    width: 100%;  
    height: 100%; 
    object-fit: cover; 
    border-radius: 8px;
    border: none;
  }
  @keyframes matchPulse {
    0%   { transform: rotateY(180deg) scale(1); box-shadow: 0 0 0px 0 rgba(0,255,128,0); }
    40%  { transform: rotateY(180deg) scale(1.15); box-shadow: 0 0 25px 10px rgba(0,255,128,0.8); }
    100% { transform: rotateY(180deg) scale(1); box-shadow: 0 0 0px 0 rgba(0,255,128,0); }
  }

  .card.matched .card-inner {
    animation: matchPulse 0.7s ease;
  }

  #winnerOverlay{
    position:fixed; inset:0; 
    padding: 20px;
    display:none;
    align-items:center; 
    justify-content:center;
    background: rgba(0,0,0,0.55); 
    z-index:1200; 
    overflow:hidden;
  }
  #winnerBox{
    position:relative; width:min(92vw,520px);
    background:#fff8d6; border-radius:18px; padding:22px 28px; text-align:center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.18); z-index:2;
    transform-origin:center; animation: popIn .5s ease;
  }
  @keyframes popIn {
    0% { transform: scale(.8); opacity:0 }
    70% { transform: scale(1.05); opacity:1 }
    100% { transform: scale(1); }
  }

  #newGameBtn {
    margin-top:6px;
    background: #ff5146; color:#fff; border:none; border-radius:12px;
    padding:12px 20px; font-size:1.05rem; cursor:pointer;
    font-family:inherit; transition: transform .12s ease, background .12s ease;
  }
  #newGameBtn:hover { transform: scale(1.04); background:#e6453c; }
  #newGameBtn:active { transform: scale(.98); }

  #closeOverlay {
    position:absolute; top:10px; right:10px;
    width:22px; height:22px; padding:0; border-radius:50%;
    border:1px solid rgba(0,0,0,0.08);
    background: rgba(0,0,0,0.04); color:#666; font-size:13px; line-height:22px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; opacity:.92;
  }
  #closeOverlay:hover { background: rgba(0,0,0,0.07); opacity:1 }
  #closeOverlay:focus { outline: 2px solid rgba(0,0,0,0.12); outline-offset:2px; }

  .confetti {
    position:absolute; top:-20px; width:10px; height:10px; opacity:0.98;
    pointer-events:none; will-change: transform, opacity;
    border-radius: 2px;
  }

  @keyframes confettiFall {
    0%   { transform: translate3d(0, -12vh, 0) rotate(0deg); opacity:1; }
    100% { transform: translate3d(var(--drift,0px), 110vh, 0) rotate(720deg); opacity:0; }
  }

  @media (max-width:480px){
    header h1 { font-size:1.5rem }
    #winnerBox { padding:20px 22px }
  }

</style>
</head>
<body>

<header>
  <h1>Unser ‚ù§Ô∏è Memory</h1>
  <div class="scoreboard">
    <div id="player1" class="player"><span id="score1">0</span></div>
    <div id="player2" class="player"><span id="score2">0</span></div>
  </div>
</header>

<div id="gameBoard" class="game-board"></div>

<div id="winnerOverlay">
  <div id="winnerBox">
    <button id="closeOverlay">√ó</button>
    <h2 id="winnerText">üéâ Gewinner! üéâ</h2>
    <button id="newGameBtn">Neues Spiel</button>
  </div>
</div>

<script>
  // === Einstellungen ===
  const flipDelay = 3000; // Zeit in ms, wie lange Karten sichtbar bleiben
  const player1 = "Antje"; // Hier den Namen des ersten Spielers eintragen
  const player2 = "Wolfgang";
  
  let gridRows, gridCols;
  function calcGrid() {
    const width = window.innerWidth;
    const height = window.innerHeight;

    // Bestimme Anzahl Spalten basierend auf Breite
    let cols;
    if (width < 480) cols = 4;
    else if (width < 768) cols = 5;
    else cols = 6;

    // Bestimme Anzahl Reihen basierend auf H√∂he
    let rows;
    if (height < 500) rows = 4;
    else if (height < 800) rows = 6;
    else rows = 8;

console.log("cols:", cols);
console.log("rows:", rows);

    gridCols = cols;
    gridRows = rows;
  }
  calcGrid();

  function resizeCards() {
    const board = document.getElementById('gameBoard');
    const gap = 15;
    const minCardSize = 70;

    const availableWidth = window.innerWidth - 20;
    const availableHeight = window.innerHeight - board.getBoundingClientRect().top - 40;

    const cardWidth = (availableWidth - (gridCols - 1) * gap) / gridCols;
    const cardHeight = (availableHeight - (gridRows - 1) * gap) / gridRows;
    const cardSize = Math.max(minCardSize, Math.min(cardWidth, cardHeight));

    console.log("cardWidth:", cardWidth);
    console.log("cardHeight:", cardHeight);
    console.log("card size:", cardSize);
    gameBoard.style.gridTemplateColumns = `repeat(${gridCols}, ${cardSize}px)`;
    gameBoard.style.gridTemplateRows = `repeat(${gridRows}, ${cardSize}px)`;

  }
  window.addEventListener('resize', resizeCards);

  const totalPairs = () => 2; //(gridRows * gridCols) / 2;

  // === Getr√§nke-Daten ===
const drinksData = [
  {
    player1: [
      { img: 'images/almkraÃàutertee.png', description: 'Almkr√§utertee' },
      { img: 'images/aperol.png', description: 'Aperol' }
    ],
    player2: [
      { img: 'images/aperol.png', description: 'Aperol' },
    ]
  },
  {
    player1: [
      { img: 'images/bionade.png', description: 'Bionade' }
    ],
    player2: [
      { img: 'images/bier.png', description: 'Bier' },
    ]
  },
  {
    player1: [
      { img: 'images/caipi.png', description: 'Caipi' },
      { img: 'images/cuba_libre.png', description: 'Cuba Libre' },
    ],
    player2: [
      { img: 'images/caipi.png', description: 'Caipi' },
      { img: 'images/cuba_libre.png', description: 'Cuba Libre' },
    ]
  },
  {
    player1: [
      { img: 'images/darjeeling.png', description: 'Darjeeling' },
    ],
    player2: [
      { img: 'images/darjeeling.png', description: 'Darjeeling' },
    ]
  }


];

  let currentPlayer;
  let score1 = 0, score2 = 0;
  let flippedCards = [];
  let matchedCount = 0;

  function initGame() {
    score1 = 0; score2 = 0; matchedCount = 0;
    document.getElementById('score1').textContent = score1;
    document.getElementById('score2').textContent = score2;

    document.getElementById('player1').innerHTML = `üë© ${player1}: <span id="score1">0</span>`;
    document.getElementById('player2').innerHTML = `üë® ${player2}: <span id="score2">0</span>`;

    // Startspieler zuf√§llig bestimmen
    currentPlayer = Math.random() < 0.5 ? 1 : 2;
    updateActivePlayer();

    const selectedDrinks = shuffleArray(drinksData).slice(0, totalPairs());
    console.log("selectedDrinks:", selectedDrinks);
    const cardSet = [];

    selectedDrinks.forEach((drinkPair, index) => {
      const player1Drink = drinkPair.player1[Math.floor(Math.random() * drinkPair.player1.length)];
      const player2Drink = drinkPair.player2[Math.floor(Math.random() * drinkPair.player2.length)];
      const pairKey = `pair_${index}`;

      cardSet.push({ 
        type: 'player1',
        content: player1Drink.img, 
        description: player1Drink.description,
        matchKey: pairKey  
      });
      cardSet.push({ 
        type: 'player2', 
        content: player2Drink.img, 
        description: player2Drink.description,
        matchKey: pairKey 
      });
    });

    const shuffledCards = shuffleArray(cardSet);
    const gameBoard = document.getElementById('gameBoard');
    
    gameBoard.innerHTML = '';
    shuffledCards.forEach((card, index) => {
      const cardEl = document.createElement('div');
      cardEl.classList.add('card');
      cardEl.dataset.type = card.type;
      cardEl.dataset.matchKey = card.matchKey;
      cardEl.dataset.index = index;
      cardEl.title = card.description;

      const cardInner = document.createElement('div');
      cardInner.classList.add('card-inner');

      const cardFront = document.createElement('div');
      cardFront.classList.add('card-front');
      const cardFrontImg = document.createElement('img');
      cardFrontImg.src = 'images/background.png';
      cardFrontImg.alt = '?';
      cardFront.appendChild(cardFrontImg);

      const cardBack = document.createElement('div');
      cardBack.classList.add('card-back');
      const cardBackImg = document.createElement('img');
      cardBackImg.src = card.content;
      cardBackImg.alt = card.description;
      cardBack.appendChild(cardBackImg);

      cardInner.appendChild(cardFront);
      cardInner.appendChild(cardBack);
      cardEl.appendChild(cardInner);

      cardEl.addEventListener('click', () => flipCard(cardEl));
      gameBoard.appendChild(cardEl);
    });
    resizeCards();
  }

  function flipCard(cardEl) {
    if (cardEl.classList.contains('flipped') || cardEl.classList.contains('matched') || flippedCards.length === 2) {
      return;
    }
    cardEl.classList.add('flipped');
    flippedCards.push(cardEl);

    if (flippedCards.length === 2) {
      checkMatch();
    }
  }

  function checkMatch() {
    const [first, second] = flippedCards;
    if (first.dataset.matchKey === second.dataset.matchKey && first.dataset.type !== second.dataset.type) {
      setTimeout(() => {
        first.classList.add('matched');
        second.classList.add('matched');
        matchedCount++;
        if (currentPlayer === 1) {
            score1++;
            document.getElementById('score1').textContent = score1;
        } else {
            score2++;
            document.getElementById('score2').textContent = score2;
        }
        flippedCards = [];
        if (matchedCount === totalPairs()) {
            setTimeout(endGame, 500);
        }
      }, 700); // 0.7s pulse effekt
    }
    else {
        setTimeout(() => {
            first.classList.remove('flipped');
            second.classList.remove('flipped');
            flippedCards = [];
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateActivePlayer();
        }, flipDelay);
    }
  }

  function updateActivePlayer() {
    document.getElementById("player1").classList.toggle("active", currentPlayer === 1);
    document.getElementById("player2").classList.toggle("active", currentPlayer === 2);
  }

  function endGame() {
    let winner = '';
    if (score1 > score2) winner = `${player1} gewinnt! üéâ`;
    else if (score2 > score1) winner = `${player2} gewinnt! üéâ`;
    else winner = 'Unentschieden! ü§ù';
    showWinnerOverlay(winner);
  }

  function clearConfetti() {
    document.querySelectorAll('#winnerOverlay .confetti').forEach(n => n.remove());
  }

function launchConfetti(count = 120, durationBase = 3500) {
  const overlay = document.getElementById('winnerOverlay');
  const rect = overlay.getBoundingClientRect();
  const colors = ['#ff3366','#ffcc00','#66ccff','#33cc66','#9b59b6'];

  clearConfetti();

  for (let i = 0; i < count; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    const size = 6 + Math.random() * 8;
    el.style.width = size + 'px';
    el.style.height = size + 'px';
    el.style.backgroundColor = colors[(Math.random() * colors.length) | 0];

    const startX = Math.random() * rect.width;
    const drift = (Math.random() - 0.5) * 240;
    const duration = durationBase + Math.random() * 1500; // Basiswert + Zufall
    const delay = Math.random() * 250;
    el.style.left = startX + 'px';

    overlay.appendChild(el);

    if (el.animate) {
      const rot = 360 + Math.random() * 360;
      el.animate([
        { transform: 'translate3d(0, -12px, 0) rotate(0deg)',   opacity: 1 },
        { transform: `translate3d(${drift}px, ${rect.height + 60}px, 0) rotate(${rot}deg)`, opacity: 0 }
      ], { duration, delay, easing: 'linear', fill: 'forwards' });
      setTimeout(() => el.remove(), duration + delay + 100);
    } else {
      el.style.setProperty('--x', startX + 'px');
      el.style.setProperty('--drift', drift + 'px');
      el.style.animation = `confettiFall ${duration}ms linear ${delay}ms forwards`;
      setTimeout(() => el.remove(), duration + delay + 500);
    }
  }
}
  function showWinnerOverlay(text) {
    const overlay = document.getElementById('winnerOverlay');
    document.getElementById('winnerText').textContent = text;
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden', 'false');

    // force reflow ‚Äì hilft insbesondere auf iOS/Safari damit Animationen sicher starten
    void overlay.offsetHeight;

    // startee Konfetti (nach Reflow)
    launchConfetti(200, 5000);
  }

  // Button-Handler f√ºr Overlay
  document.getElementById('newGameBtn').addEventListener('click', () => {
    document.getElementById('winnerOverlay').style.display = 'none';
    document.getElementById('winnerOverlay').setAttribute('aria-hidden','true');
    clearConfetti();
    initGame();
  });

  document.getElementById('closeOverlay').addEventListener('click', () => {
    document.getElementById('winnerOverlay').style.display = 'none';
    document.getElementById('winnerOverlay').setAttribute('aria-hidden','true');
    clearConfetti();
  });


  function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  document.getElementById('newGameBtn').addEventListener('click', () => {
    document.getElementById('winnerOverlay').style.display = 'none';
    initGame();
  });

  document.getElementById('closeOverlay').addEventListener('click', () => {
    document.getElementById('winnerOverlay').style.display = 'none';
  });

  initGame();
</script>
</body>
</html>