<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lieblingsgetr√§nke Memory</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@500;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Comic Neue', 'Comic Sans MS', cursive, sans-serif;
    background: #ffd27f; /* feste Farbe */
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 0;
  }


  header {
    text-align: center;
    padding: 10px;
    color: #333;
  }


  #settingsOverlay {
    position: fixed; inset:0; display:none;
    align-items:center; justify-content:center;
    background: rgba(0,0,0,0.55); z-index:1200;
  }

  #settingsBox {
    position: relative; 
    background:#fff8d6; 
    border-radius:18px; 
    padding: 24px 36px;
    text-align:center;
    max-width:90vw;
    z-index:2;
  }

  #settingsBox h2 { margin-bottom: 18px; color:#ff3366; }

  #settingsBox .setting {
    margin: 12px 0;
    text-align:left;
  }

  #settingsBox label {
    display:block; margin-bottom:6px; font-weight:bold; font-size:1rem;
  }

  #settingsBox select {
    width:100%; padding:6px 10px; border-radius:8px; border:2px dashed #333;
    font-family:'Comic Neue', 'Comic Sans MS', cursive;
    font-size:1rem;
  }

  #applySettingsBtn {
    margin-top:16px; 
    background:#ff5146; color:#fff; border:none; border-radius:12px;
    padding:10px 18px; font-size:1.05rem; cursor:pointer; font-family:inherit;
    transition: transform .12s, background .12s;
  }
  #applySettingsBtn:hover { background:#e6453c; transform:scale(1.04); }
  #applySettingsBtn:active { transform:scale(.96); }

  #closeSettings {
    position:absolute; top:8px; right:8px;
    width:22px; height:22px; border-radius:50%; background:rgba(0,0,0,0.05);
    border:1px solid rgba(0,0,0,0.1); color:#666; font-size:13px;
    display:flex; align-items:center; justify-content:center; cursor:pointer; opacity:.9;
  }
  #closeSettings:hover { background:rgba(0,0,0,0.08); opacity:1; }


  .scoreboard {
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }
  .player {
    padding: 4px 10px;
    border-radius: 8px;
    transition: all 0.3s;
  }
  .active {
    background: #ff6f61;
    color: #fff;
    transform: scale(1.1);
  }
  .game-board {
    display: grid;
    justify-content: center;
    gap: 15px;
    max-width: 95vw;
  }

  .card {
    perspective: 1000px;
    aspect-ratio: 1 / 1;
    position: relative;
  }
  .card-inner {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0; 
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    border-radius: 12px;
    box-sizing: border-box; 
  }
  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }
  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0; 
    box-sizing: border-box;
    backface-visibility: hidden;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.5rem;
    border: 3px solid #333;
  }
  .card-front {
    background: #fff3c4;
    color: #333;
    overflow: hidden;
  }
  .card-front img {
    display: block;
    width: 100%; 
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    border: none; 
  }
  .card-back {
    background: #ff6f61;
    transform: rotateY(180deg);
    overflow: hidden;
  }
  .card-back img {
    display: block;
    width: 100%;  
    height: 100%; 
    object-fit: cover; 
    border-radius: 8px;
    border: none;
  }
  @keyframes matchPulse {
    0%   { transform: rotateY(180deg) scale(1); box-shadow: 0 0 0px 0 rgba(0,255,128,0); }
    40%  { transform: rotateY(180deg) scale(1.15); box-shadow: 0 0 25px 10px rgba(0,255,128,0.8); }
    100% { transform: rotateY(180deg) scale(1); box-shadow: 0 0 0px 0 rgba(0,255,128,0); }
  }

  .card.matched .card-inner {
    animation: matchPulse 0.7s ease;
  }


  #winnerOverlay{
    position:fixed; inset:0; 
    padding: 20px;
    display:none;
    align-items:center; 
    justify-content:center;
    background: rgba(0,0,0,0.55); 
    z-index:1200; 
    overflow:hidden;
  }
  #winnerBox{
    position:relative; width:min(92vw,520px);
    background:#fff8d6; border-radius:18px; padding:22px 28px; text-align:center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.18); z-index:10;
    transform-origin:center; animation: popIn .5s ease;
  }
  @keyframes popIn {
    0% { transform: scale(.8); opacity:0 }
    70% { transform: scale(1.05); opacity:1 }
    100% { transform: scale(1); }
  }

  #newGameBtn {
    margin-top:6px;
    background: #ff5146; color:#fff; border:none; border-radius:12px;
    padding:12px 20px; font-size:1.05rem; cursor:pointer;
    font-family:inherit; transition: transform .12s ease, background .12s ease;
  }
  #newGameBtn:hover { transform: scale(1.04); background:#e6453c; }
  #newGameBtn:active { transform: scale(.98); }

  #closeOverlay {
    position:absolute; top:10px; right:10px;
    width:22px; height:22px; padding:0; border-radius:50%;
    border:1px solid rgba(0,0,0,0.08);
    background: rgba(0,0,0,0.04); color:#666; font-size:13px; line-height:22px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; opacity:.92;
  }
  #closeOverlay:hover { background: rgba(0,0,0,0.07); opacity:1 }
  #closeOverlay:focus { outline: 2px solid rgba(0,0,0,0.12); outline-offset:2px; }

  .confetti {
    position:absolute; 
    top:-20px; 
    width:10px; 
    height:10px; 
    z-index: 20;
    opacity:0.98;
    pointer-events:none; 
    will-change: transform, opacity;
    border-radius: 2px;
  }

  @keyframes confettiFall {
    0%   { transform: translate3d(0, -12vh, 0) rotate(0deg); opacity:1; }
    100% { transform: translate3d(var(--drift,0px), 110vh, 0) rotate(720deg); opacity:0; }
  }

  @media (max-width:480px){
    header h1 { 
      font-size:1.5rem 
    }
    #winnerBox { 
      padding:20px 22px 
    }
  }

</style>
</head>
<body>

<header>
  <h1>Unser <span id="settingsBtn" style="cursor:pointer;">‚ù§Ô∏è</span> Memory</h1>
  <div class="scoreboard">
    <div id="player1" class="player"><span id="score1">0</span></div>
    <div id="player2" class="player"><span id="score2">0</span></div>
  </div>
</header>

<div id="settingsOverlay" aria-hidden="true">
  <div id="settingsBox">
    <button id="closeSettings" title="Schlie√üen">√ó</button>
    <h2>Einstellungen</h2>

    <div class="setting">
      <label for="difficultySelect">Schwierigkeit:</label>
      <select id="difficultySelect">
        <option value="normal">Harmonisch</option>
        <option value="hard">Knifflig</option>
      </select>
    </div>

    <div class="setting">
      <label for="pairsSelect">Anzahl der Paare:</label>
      <select id="pairsSelect"></select>
    </div>

    <button id="applySettingsBtn">√úbernehmen</button>
  </div>
</div>

<div id="gameBoard" class="game-board"></div>

<div id="winnerOverlay">
  <div id="winnerBox">
    <button id="closeOverlay">√ó</button>
    <h2 id="winnerText">üéâ Gewinner! üéâ</h2>
    <button id="newGameBtn">Neues Spiel</button>
  </div>
</div>

<script>
  // === Einstellungen ===
  const flipDelay = 3000; // Zeit in ms, wie lange Karten sichtbar bleiben
  const player1 = "Antje"; // Hier den Namen des ersten Spielers eintragen
  const player2 = "Wolfgang";

  const drinksData = [
    {
      player1: [
        { img: 'images/almkraÃàutertee.png', description: 'Almkr√§utertee' },
        { img: 'images/aperol.png', description: 'Aperol' }
      ],
      player2: [
        { img: 'images/aperol.png', description: 'Aperol' },
      ]
    },
    {
      player1: [
        { img: 'images/bionade.png', description: 'Bionade' }
      ],
      player2: [
        { img: 'images/bier.png', description: 'Bier' },
      ]
    },
    {
      player1: [
        { img: 'images/caipi.png', description: 'Caipi' },
        { img: 'images/cuba_libre.png', description: 'Cuba Libre' },
      ],
      player2: [
        { img: 'images/caipi.png', description: 'Caipi' },
        { img: 'images/cuba_libre.png', description: 'Cuba Libre' },
      ]
    },
    {
      player1: [
        { img: 'images/darjeeling.png', description: 'Darjeeling' },
      ],
      player2: [
        { img: 'images/doppelkorn.png', description: 'Doppelkorn' },
      ]
    },
    {
      player1: [
        { img: 'images/eisschokolade.png', description: 'Eisschokolade' },
      ],
      player2: [
        { img: 'images/eisschokolade.png', description: 'Eisschokolade' },
        { img: 'images/espresso.png', description: 'Espresso' },
      ]
    },
    {
      player1: [
        { img: 'images/feuerzangenbowle.png', description: 'Feuerzangenbowle' },
        { img: 'images/fencheltee.png', description: 'Fencheltee' },
      ],
      player2: [
        { img: 'images/feuerzangenbowle.png', description: 'Feuerzangenbowle' },
      ]
    },
    {
      player1: [
        { img: 'images/gl√ºhwein.png', description: 'Gl√ºhwein' },
        { img: 'images/gr√ºner_tee.png', description: 'Gr√ºner Tee' },
      ],
      player2: [
        { img: 'images/gl√ºhwein.png', description: 'Gl√ºhwein' },
        { img: 'images/gr√ºner_tee.png', description: 'Gr√ºner Tee' },
        { img: 'images/gin.png', description: 'Gin' },
      ]
    },
    {
      player1: [
        { img: 'images/holunderbl√ºtensaft.png', description: 'Holunderbl√ºtensaft' },
      ],
      player2: [
        { img: 'images/heisse_schokolade.png', description: 'Hei√üe Schokolade' },
      ]
    },
    {
      player1: [
        { img: 'images/ingwertee.png', description: 'Ingwertee' },
      ],
      player2: [
        { img: 'images/irish_coffee.png', description: 'Irish Coffee' },
      ]
    },
    {
      player1: [
        { img: 'images/johannisbeerschorle.png', description: 'Johannisbeerschorle' },
        { img: 'images/jasmin_tee.png', description: 'Jasmin-Tee' },
      ],
      player2: [
        { img: 'images/johannisbeerschorle.png', description: 'Johannisbeerschorle' },
        { img: 'images/jasmin_tee.png', description: 'Jasmin-Tee' },
      ]
    },
    {
      player1: [
        { img: 'images/kiba.png', description: 'Ki-Ba' },
      ],
      player2: [
        { img: 'images/kiba.png', description: 'Ki-Ba' },
        { img: 'images/kaffee.png', description: 'Kaffee' },
      ]
    },
    {
      player1: [
        { img: 'images/leitungswasser.png', description: 'Leitungswasser' },
        { img: 'images/lillet_rose.png', description: 'Lillet Rose' },
      ],
      player2: [
        { img: 'images/leitungswasser.png', description: 'Leitungswasser' },
        { img: 'images/lillet_rose.png', description: 'Lillet Rose' },
      ]
    },
    {
      player1: [
        { img: 'images/minztee.png', description: 'Minztee' },
        { img: 'images/moscow_mule.png', description: 'Moscow Mule' },
      ],
      player2: [
        { img: 'images/minztee.png', description: 'Minztee' },
        { img: 'images/moscow_mule.png', description: 'Moscow Mule' },
      ]
    },

  ];
  
  let currentPlayer;
  let score1 = 0, score2 = 0;
  let gameDifficulty = 'normal';
  let flippedCards = [];
  let matchedCount = 0;
  let gridCols, gridRows;
  let selectedPairs;
  
  function getGridLimits() {
    let maxCols, maxRows;
    
    if (window.innerWidth < 480) maxCols = 4;
    else if (window.innerWidth < 768) maxCols = 5;
    else maxCols = 6;

    if (window.innerHeight < 500) maxRows = 4;
    else if (window.innerHeight < 800) maxRows = 6;
    else maxRows = 8;

    return { maxCols, maxRows };
  }


  function calcOptimalGrid(pairs) {
    const cards = pairs * 2;
    const { maxCols, maxRows } = getGridLimits();

    const board = document.getElementById('gameBoard');
    const gap = 15;
    const minCardSize = 70;

    const availableWidth = window.innerWidth - 20;
    const availableHeight = window.innerHeight - board.getBoundingClientRect().top - 40;

    let bestRows = 1, bestCols = cards, bestCardSize = minCardSize;

    for (let r = 1; r <= Math.min(maxRows, cards); r++) {
        let c = Math.ceil(cards / r);
        if (c > maxCols) continue;

        let cardWidth = (availableWidth - (c - 1) * gap) / c;
        let cardHeight = (availableHeight - (r - 1) * gap) / r;
        let cardSize = Math.max(minCardSize, Math.min(cardWidth, cardHeight));

        if (cardSize > bestCardSize || (cardSize === bestCardSize && Math.abs(r - c) < Math.abs(bestRows - bestCols))) {
            bestRows = r;
            bestCols = c;
            bestCardSize = cardSize;
        }
    }

    return { rows: bestRows, cols: bestCols, cardSize: bestCardSize };
  } 

  function getAvailablePairs(difficulty) {
    if (difficulty === "normal") {
        return drinksData.filter(d =>
            d.player1.some(d1 => d.player2.some(d2 => d2.img === d1.img))
        );
    } else {
        return drinksData;
    }
  }

  function populatePairsOptions() {
    const { maxCols, maxRows } = getGridLimits();
    const availablePairs = getAvailablePairs(gameDifficulty);

    const maxPairsAllowed = Math.floor(maxCols * maxRows / 2);
    const totalPairs = Math.min(availablePairs.length, maxPairsAllowed);

    pairsSelect.innerHTML = '';
    for (let i = 1; i <= totalPairs; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = i;
        pairsSelect.appendChild(opt);
    }

    pairsSelect.value = selectedPairs || totalPairs;
    if (!selectedPairs) {
      selectedPairs = totalPairs; 
    }
  }

  function resizeCards() {
    const { cardSize } = calcOptimalGrid(selectedPairs);
    gameBoard.style.gridTemplateColumns = `repeat(${gridCols}, ${cardSize}px)`;
    gameBoard.style.gridTemplateRows = `repeat(${gridRows}, ${cardSize}px)`;

    return cardSize;
  }

  function initDefaults() {
    const { maxCols, maxRows } = getGridLimits();
    let availablePairs = getAvailablePairs(gameDifficulty);  
    
    selectedPairs = Math.min(availablePairs.length, Math.floor(maxCols*maxRows/2));

    const { cols, rows } = calcOptimalGrid(selectedPairs);
    gridCols = cols;
    gridRows = rows;
  }

  function initGame() {
    score1 = 0; score2 = 0; matchedCount = 0;
    document.getElementById('score1').textContent = score1;
    document.getElementById('score2').textContent = score2;

    document.getElementById('player1').innerHTML = `üë© ${player1}: <span id="score1">0</span>`;
    document.getElementById('player2').innerHTML = `üë® ${player2}: <span id="score2">0</span>`;

    // Startspieler zuf√§llig bestimmen
    currentPlayer = Math.random() < 0.5 ? 1 : 2;
    updateActivePlayer();

    let shuffledPairs = shuffleArray(getAvailablePairs(gameDifficulty));

    const cardSet = [];
    shuffledPairs.slice(0, selectedPairs).forEach((drinkPair, index) => {
      let player1Drink, player2Drink;
      if(gameDifficulty === 'normal') {
        const sameDrinks = drinkPair.player1.filter(d1 =>
          drinkPair.player2.some(d2 => d2.img === d1.img)
        );
        const drink = sameDrinks[Math.floor(Math.random() * sameDrinks.length)];
        player1Drink = player2Drink = drink;
      } else {
        player1Drink = drinkPair.player1[Math.floor(Math.random()*drinkPair.player1.length)];
        player2Drink = drinkPair.player2[Math.floor(Math.random()*drinkPair.player2.length)];
      }

      if (player1Drink && player2Drink) {
        const pairKey = `pair_${index}`;
        cardSet.push({ 
            type: 'player1',
            content: player1Drink.img, 
            description: player1Drink.description,
            matchKey: pairKey  
          });
          cardSet.push({ 
            type: 'player2', 
            content: player2Drink.img, 
            description: player2Drink.description,
            matchKey: pairKey 
          });    
      }
    });

    const shuffledCards = shuffleArray(cardSet);
    const gameBoard = document.getElementById('gameBoard');

    gameBoard.innerHTML = '';
    shuffledCards.forEach((card, index) => {
      const cardEl = document.createElement('div');
      cardEl.classList.add('card');
      cardEl.dataset.type = card.type;
      cardEl.dataset.matchKey = card.matchKey;
      cardEl.dataset.index = index;
      cardEl.title = card.description;

      const cardInner = document.createElement('div');
      cardInner.classList.add('card-inner');

      const cardFront = document.createElement('div');
      cardFront.classList.add('card-front');
      const cardFrontImg = document.createElement('img');
      cardFrontImg.src = 'images/background.png';
      cardFrontImg.alt = '?';
      cardFront.appendChild(cardFrontImg);

      const cardBack = document.createElement('div');
      cardBack.classList.add('card-back');
      const cardBackImg = document.createElement('img');
      cardBackImg.src = card.content;
      cardBackImg.alt = card.description;
      cardBack.appendChild(cardBackImg);

      cardInner.appendChild(cardFront);
      cardInner.appendChild(cardBack);
      cardEl.appendChild(cardInner);

      cardEl.addEventListener('click', () => flipCard(cardEl));
      gameBoard.appendChild(cardEl);
    });

    resizeCards();
  }

  function flipCard(cardEl) {
    if (cardEl.classList.contains('flipped') || cardEl.classList.contains('matched') || flippedCards.length === 2) {
      return;
    }
    cardEl.classList.add('flipped');
    flippedCards.push(cardEl);

    if (flippedCards.length === 2) {
      checkMatch();
    }
  }

  function checkMatch() {
    const [first, second] = flippedCards;
    if (first.dataset.matchKey === second.dataset.matchKey && first.dataset.type !== second.dataset.type) {
      setTimeout(() => {
        first.classList.add('matched');
        second.classList.add('matched');
        matchedCount++;
        if (currentPlayer === 1) {
            score1++;
            document.getElementById('score1').textContent = score1;
        } else {
            score2++;
            document.getElementById('score2').textContent = score2;
        }
        flippedCards = [];
        if (matchedCount === selectedPairs) {
            setTimeout(endGame, 500);
        }
      }, 700); // 0.7s pulse effekt
    }
    else {
        setTimeout(() => {
            first.classList.remove('flipped');
            second.classList.remove('flipped');
            flippedCards = [];
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateActivePlayer();
        }, flipDelay);
    }
  }

  function updateActivePlayer() {
    document.getElementById("player1").classList.toggle("active", currentPlayer === 1);
    document.getElementById("player2").classList.toggle("active", currentPlayer === 2);
  }

  function endGame() {
    let winner = '';
    if (score1 > score2) winner = `üéâ ${player1} gewinnt! üéâ`;
    else if (score2 > score1) winner = `üéâ ${player2} gewinnt! üéâ`;
    else winner = 'Unentschieden! ü§ù';
    showWinnerOverlay(winner);
  }

  function clearConfetti() {
    document.querySelectorAll('#winnerOverlay .confetti').forEach(n => n.remove());
  }

  function launchConfetti(count = 120, durationBase = 3500, spreadTime = 2000) {
    const overlay = document.getElementById('winnerOverlay');
    const rect = overlay.getBoundingClientRect();
    const colors = ['#ff3366','#ffcc00','#66ccff','#33cc66','#9b59b6'];

    clearConfetti();

    for (let i = 0; i < count; i++) {
      setTimeout(() => {
        const el = document.createElement('div');
        el.className = 'confetti';
        const size = 6 + Math.random() * 8;
        el.style.width = size + 'px';
        el.style.height = size + 'px';
        el.style.backgroundColor = colors[(Math.random() * colors.length) | 0];

        const startX = Math.random() * rect.width;
        const drift = (Math.random() - 0.5) * 240;
        const duration = durationBase + Math.random() * 2000;
        el.style.left = startX + 'px';

        overlay.appendChild(el);

        if (el.animate) {
          const rot = 360 + Math.random() * 720;
          el.animate([
            { transform: 'translate3d(0, -12px, 0) rotate(0deg)', opacity: 1 },
            { transform: `translate3d(${drift}px, ${rect.height + 60}px, 0) rotate(${rot}deg)`, opacity: 0 }
          ], { duration, easing: 'linear', fill: 'forwards' });
          setTimeout(() => el.remove(), duration + 100);
        } else {
          // Fallback
          el.style.setProperty('--x', startX + 'px');
          el.style.setProperty('--drift', drift + 'px');
          el.style.animation = `confettiFall ${duration}ms linear forwards`;
          setTimeout(() => el.remove(), duration + 500);
        }
      }, Math.random() * spreadTime); // jedes Schnipsel startet zu einer zuf√§lligen Zeit
    }
  }

  function showWinnerOverlay(text) {
    const overlay = document.getElementById('winnerOverlay');
    document.getElementById('winnerText').textContent = text;
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden', 'false');

    // force reflow ‚Äì hilft insbesondere auf iOS/Safari damit Animationen sicher starten
    void overlay.offsetHeight;

    launchConfetti(200, 5000, 2000);
  }

  function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  initDefaults();
  initGame();

  const settingsOverlay = document.getElementById('settingsOverlay');
  const settingsBtn = document.getElementById('settingsBtn');
  const closeSettings = document.getElementById('closeSettings');
  const applySettingsBtn = document.getElementById('applySettingsBtn');

  const difficultySelect = document.getElementById('difficultySelect');

  difficultySelect.addEventListener('change', () => {
      gameDifficulty = difficultySelect.value;
      populatePairsOptions();
  });

  settingsBtn.addEventListener('click', () => {
      populatePairsOptions();
      settingsOverlay.style.display = 'flex';
      settingsOverlay.setAttribute('aria-hidden','false');
  });
  closeSettings.addEventListener('click', () => {
    document.activeElement.blur();
    settingsOverlay.style.display = 'none';
    settingsOverlay.setAttribute('aria-hidden','true');
  });

  applySettingsBtn.addEventListener('click', () => {
      selectedPairs = parseInt(pairsSelect.value);
      const { cols, rows } = calcOptimalGrid(selectedPairs);
      gridCols = cols;
      gridRows = rows;

      document.activeElement.blur();
      settingsOverlay.style.display = 'none';
      settingsOverlay.setAttribute('aria-hidden','true');

      initGame();
  });

  document.getElementById('newGameBtn').addEventListener('click', () => {
    document.activeElement.blur();
    document.getElementById('winnerOverlay').style.display = 'none';
    document.getElementById('winnerOverlay').setAttribute('aria-hidden','true');
    clearConfetti();
    initGame();
  });

  document.getElementById('closeOverlay').addEventListener('click', () => {
    document.activeElement.blur();
    document.getElementById('winnerOverlay').style.display = 'none';
    document.getElementById('winnerOverlay').setAttribute('aria-hidden','true');
    clearConfetti();
  });

  window.addEventListener('resize', resizeCards);

</script>
</body>
</html>